<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.12"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Leosac: Remote Control Documentation</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Leosac
   &#160;<span id="projectnumber">0.6.3</span>
   </div>
   <div id="projectbrief">OpenSourceAccessControl</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.12 -->
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',false,false,'search.php','Search');
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Remote Control Documentation </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#remote_control_intro">Introduction </a></li>
<li class="level1"><a href="#remote_control_user_config">Configuration Options </a><ul><li class="level2"><a href="#remote_control_example">Example </a></li>
</ul>
</li>
<li class="level1"><a href="#remote_control_features">Exposed features </a><ul><li class="level2"><a href="#remote_control_cmd_module_list">MODULE_LIST </a></li>
<li class="level2"><a href="#remote_control_cmd_general_config">GENERAL_CONFIG </a></li>
<li class="level2"><a href="#remote_control_cmd_module_config">MODULE_CONFIG </a></li>
<li class="level2"><a href="#remote_control_cmd_sync_from">SYNC_FROM </a></li>
<li class="level2"><a href="#remote_control_save">SAVE </a></li>
<li class="level2"><a href="#remote_control_config_version">CONFIG_VERSION </a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><p>Documentation of <a class="el" href="../../d6/d58/namespaceLeosac.html">Leosac</a>'s remote interface.</p>
<h1><a class="anchor" id="remote_control_intro"></a>
Introduction </h1>
<p><a class="el" href="../../d6/d58/namespaceLeosac.html">Leosac</a> has a built-in remote control functionality. This means two things:</p><ol type="1">
<li>The user can interact remotely with <a class="el" href="../../d6/d58/namespaceLeosac.html">Leosac</a>.</li>
<li><a class="el" href="../../d6/d58/namespaceLeosac.html">Leosac</a> installation can talk to each other.</li>
</ol>
<p>We aim to provide this functionality in a secure fashion. This means all connections to the remote control socket will be encrypted. We use the CURVE security mechanism from ZeroMQ to reach a good level of security. This security mechanism prevent both eavesdropping and man in the middle attack. Note that this an asymmetric security mechanism and require the use of a private / public keypair.</p>
<p>Currently what you can do with remote control is rather limited, and is described in a later section of this document.</p>
<p>We will now present the configuration of the remote control feature.</p>
<p><b>Limitations</b>: By default there is no authentication of incoming connection yet. Everyone that manages to connect to the remote control socket is allowed to perform ALL available operations. <b>It is however possible to configure such restrictions.</b></p>
<p><b>Limitations</b>: When using the Remote Control interface to talk to each other, <a class="el" href="../../d6/d58/namespaceLeosac.html">Leosac</a> units must use the same underlying <code>boost::serialization</code> library. Otherwise serialization failure will arise.</p>
<h1><a class="anchor" id="remote_control_user_config"></a>
Configuration Options </h1>
<p>If no <code>&lt;remote&gt;</code> tag is defined in the configuration, the remote control interface will be disabled.</p>
<table class="doxtable">
<tr>
<th>Options </th><th>Options </th><th>Options </th><th>Description </th><th>Mandatory  </th></tr>
<tr>
<td>port </td><td></td><td></td><td>Port to bind the remote control interface to </td><td>YES </td></tr>
<tr>
<td>secret_key </td><td></td><td></td><td>Z85 encoded secret key </td><td>YES </td></tr>
<tr>
<td>public_key </td><td></td><td></td><td>Z85 encoded public key </td><td>YES </td></tr>
<tr>
<td>security </td><td></td><td></td><td>Restrict access to the remote control interface </td><td>NO (default to everyone has all access) </td></tr>
<tr>
<td>&mdash;&gt; </td><td>map </td><td></td><td>Define permission for one user </td><td>YES </td></tr>
<tr>
<td>&mdash;&gt; </td><td>&mdash;&gt; </td><td>pk </td><td>Z85 public key of the remote user </td><td>YES </td></tr>
<tr>
<td>&mdash;&gt; </td><td>&mdash;&gt; </td><td>default </td><td>Default permission for unspecified command </td><td>NO (default to <code>false</code>) </td></tr>
<tr>
<td>&mdash;&gt; </td><td>&mdash;&gt; </td><td>COMMAND_NAME </td><td>Name of an existing remote control command. </td><td>NO </td></tr>
<tr>
<td>&mdash;&gt; </td><td>&mdash;&gt; </td><td>COMMAND_NAME_2 </td><td>Another existing remote control command. </td><td>NO </td></tr>
</table>
<h2><a class="anchor" id="remote_control_example"></a>
Example </h2>
<p>Remote Control configuration takes place in the <code>&lt;kernel&gt;</code> tag. It is <b>not</b> configured as a module.</p>
<p>The following example gives FULL access to anyone that can connect to the remote control socket. </p><div class="fragment"><div class="line">&lt;<span class="keywordtype">remote</span>&gt;</div><div class="line">    &lt;<span class="keywordtype">port</span>&gt;12345&lt;/<span class="keywordtype">port</span>&gt;</div><div class="line">    &lt;<span class="keywordtype">secret_key</span>&gt;<span class="keyword">Ygk2EVo</span>#<span class="keyword">hr</span>*<span class="keyword">uTG</span>=<span class="keyword">U</span>[<span class="keyword">jFFWrb9HDW-V</span>?388=<span class="keyword">kj</span>)<span class="keyword">AUz</span>&lt;/<span class="keywordtype">secret_key</span>&gt;</div><div class="line">    &lt;<span class="keywordtype">public_key</span>&gt;<span class="keyword">TJz</span>$:^<span class="keyword">DbZvFN</span>@<span class="keyword">wv</span>/<span class="keyword">ct</span>&amp;[<span class="keyword">Su6Nnu6w</span>!<span class="keyword">fMGHEcIttyT</span>&lt;/<span class="keywordtype">public_key</span>&gt;</div><div class="line">&lt;/<span class="keywordtype">remote</span>&gt;</div></div><!-- fragment --><p>The following example shows how to enable some restrictions. </p><div class="fragment"><div class="line">&lt;<span class="keywordtype">remote</span>&gt;</div><div class="line">    &lt;<span class="keywordtype">port</span>&gt;12345&lt;/<span class="keywordtype">port</span>&gt;</div><div class="line">    &lt;<span class="keywordtype">secret_key</span>&gt;<span class="keyword">Ygk2EVo</span>#<span class="keyword">hr</span>*<span class="keyword">uTG</span>=<span class="keyword">U</span>[<span class="keyword">jFFWrb9HDW-V</span>?388=<span class="keyword">kj</span>)<span class="keyword">AUz</span>&lt;/<span class="keywordtype">secret_key</span>&gt;</div><div class="line">    &lt;<span class="keywordtype">public_key</span>&gt;<span class="keyword">TJz</span>$:^<span class="keyword">DbZvFN</span>@<span class="keyword">wv</span>/<span class="keyword">ct</span>&amp;[<span class="keyword">Su6Nnu6w</span>!<span class="keyword">fMGHEcIttyT</span>&lt;/<span class="keywordtype">public_key</span>&gt;</div><div class="line">    &lt;<span class="keywordtype">security</span>&gt;</div><div class="line">        &lt;<span class="keywordtype">map</span>&gt;</div><div class="line">            </div><div class="line">            &lt;<span class="keywordtype">pk</span>&gt;<span class="keyword">a_public_key</span>&lt;/<span class="keywordtype">pk</span>&gt;</div><div class="line">            &lt;<span class="keywordtype">default</span>&gt;<span class="keyword">true</span>&lt;/<span class="keywordtype">default</span>&gt;</div><div class="line">        &lt;/<span class="keywordtype">map</span>&gt;</div><div class="line">        &lt;<span class="keywordtype">map</span>&gt;</div><div class="line">            </div><div class="line">            &lt;<span class="keywordtype">pk</span>&gt;<span class="keyword">an_other_public_key</span>&lt;/<span class="keywordtype">pk</span>&gt;</div><div class="line">            &lt;<span class="keywordtype">default</span>&gt;<span class="keyword">false</span>&lt;/<span class="keywordtype">default</span>&gt;</div><div class="line">            &lt;<span class="keywordtype">MODULE_CONFIG</span>&gt;<span class="keyword">true</span>&lt;/<span class="keywordtype">MODULE_CONFIG</span>&gt;</div><div class="line">            &lt;<span class="keywordtype">MODULE_LIST</span>&gt;<span class="keyword">true</span>&lt;/<span class="keywordtype">MODULE_LIST</span>&gt;</div><div class="line">        &lt;/<span class="keywordtype">map</span>&gt;</div><div class="line">        &lt;<span class="keywordtype">map</span>&gt;</div><div class="line">            </div><div class="line">            &lt;<span class="keywordtype">pk</span>&gt;<span class="keyword">again_an_other_pubkey</span>&lt;/<span class="keywordtype">pk</span>&gt;</div><div class="line">        &lt;/<span class="keywordtype">map</span>&gt;</div><div class="line">    &lt;/<span class="keywordtype">security</span>&gt;</div><div class="line">&lt;/<span class="keywordtype">remote</span>&gt;</div></div><!-- fragment --><h1><a class="anchor" id="remote_control_features"></a>
Exposed features </h1>
<p>The set of feature available through the remote control API is rather thin.</p>
<p>You can retrieve some information about the running configuration of <a class="el" href="../../d6/d58/namespaceLeosac.html">Leosac</a>:</p><ul>
<li>The <code>MODULE_LIST</code> command will return the list of the module currently loaded on the target <a class="el" href="../../d6/d58/namespaceLeosac.html">Leosac</a> unit.</li>
<li>The <code>GENERAL_CONFIG</code> command retrieve the global configuration of <a class="el" href="../../d6/d58/namespaceLeosac.html">Leosac</a>.</li>
<li>The <code>MODULE_CONFIG</code> command retrieve the configuration for one given module.</li>
<li>The <code>SYNC_FROM</code> command order <a class="el" href="../../d6/d58/namespaceLeosac.html">Leosac</a> to fetch and apply the configuration of an other, remote, <a class="el" href="../../d6/d58/namespaceLeosac.html">Leosac</a> unit.</li>
<li>The <code>SAVE</code> command order the receiving <a class="el" href="../../d6/d58/namespaceLeosac.html">Leosac</a> to save its current configuration to disk.</li>
<li>The <code>CONFIG_VERSION</code> command returns the current serial number of the configuration. This can be used to poll for config update.</li>
</ul>
<p>See below for a detailed description of messages.</p>
<h2><a class="anchor" id="remote_control_cmd_module_list"></a>
MODULE_LIST </h2>
<p>From Client to Server:</p>
<table class="doxtable">
<tr>
<th>Frame </th><th>Content </th><th>Type  </th></tr>
<tr>
<td>1 </td><td>"MODULE_LIST" </td><td><code>string</code> </td></tr>
</table>
<p>The response, from Server to Client:</p>
<table class="doxtable">
<tr>
<th>Frame </th><th>Content </th><th>Type  </th></tr>
<tr>
<td>1 </td><td>"WIEGAND_READER" </td><td><code>string</code> </td></tr>
<tr>
<td>2 </td><td>"MONITOR" </td><td><code>string</code> </td></tr>
<tr>
<td>3 </td><td>"AN_OTHER_MODULE" </td><td><code>string</code> </td></tr>
</table>
<p>One module name per frame. As many frames as needed. Note that module names are standard and hardcoded in the module code.</p>
<h2><a class="anchor" id="remote_control_cmd_general_config"></a>
GENERAL_CONFIG </h2>
<p>The <code>GENERAL_CONFIG</code> command retrieve <a class="el" href="../../d6/d58/namespaceLeosac.html">Leosac</a>'s general configuration. This mean the configuration data except the modules' configuration.</p>
<p>It is wise to not export all the configuration. For example, the <code>&lt;remote&gt;</code> tag include the server private key. You probably don't want to share this. To control what information are sent when receiving a GENERAL_CONFIG command, see <a class="el" href="../../d2/d94/general_config_main.html#sync_source">the sync_source configuration option</a>.</p>
<table class="doxtable">
<tr>
<th>Frame </th><th>Content </th><th>Type  </th></tr>
<tr>
<td>1 </td><td>"GENERAL_CONFIG" </td><td><code>string</code> </td></tr>
<tr>
<td>2 </td><td>Configuration Type (boost text archive or xml) </td><td><code>uint8_t</code> </td></tr>
</table>
<dl class="section note"><dt>Note</dt><dd>: Configuration is an enumeration named <a class="el" href="../../d4/d7a/classLeosac_1_1ConfigManager.html#aca1f19f1376b4c0340680f7ba55bf865">ConfigFormat</a>.</dd></dl>
<p>Response</p>
<table class="doxtable">
<tr>
<th>Frame </th><th>Content </th><th>Type  </th></tr>
<tr>
<td>1 </td><td>"OK" </td><td><code>string</code> </td></tr>
<tr>
<td>2 </td><td>Configuration Content </td><td><code>string</code> </td></tr>
</table>
<p>The response is either a boost text archive, or xml.</p>
<h2><a class="anchor" id="remote_control_cmd_module_config"></a>
MODULE_CONFIG </h2>
<p>The <code>MODULE_CONFIG</code> is allowed to fail. It's possible you request the configuration of a module that is not loaded on the <a class="el" href="../../d6/d58/namespaceLeosac.html">Leosac</a> server.</p>
<p>From Client to Server:</p>
<table class="doxtable">
<tr>
<th>Frame </th><th>Content </th><th>Type  </th></tr>
<tr>
<td>1 </td><td>"MODULE_CONFIG" </td><td><code>string</code> </td></tr>
<tr>
<td>2 </td><td>"MODULE_NAME" </td><td><code>string</code> </td></tr>
<tr>
<td>3 </td><td>Configuration Type (boost text archive or xml) </td><td><code>uint8_t</code> </td></tr>
</table>
<p>From Server to Client, in case everything went well.</p>
<table class="doxtable">
<tr>
<th>Frame </th><th>Content </th><th>Type  </th></tr>
<tr>
<td>1 </td><td>"OK" </td><td><code>string</code> </td></tr>
<tr>
<td>2 </td><td>"MODULE_NAME" </td><td><code>string</code> </td></tr>
<tr>
<td>3 </td><td>Configuration Tree </td><td>Represented as <code>string</code>, this is a Boost text archive of the configuration ptree for the module. </td></tr>
<tr>
<td>4 </td><td>"filename_1" </td><td><code>string</code>. This field is optional, its here in case the module has additional configuration </td></tr>
<tr>
<td>5 </td><td>"content_of_filename_1" </td><td><code>string</code>. This field is optional, its here in case the module has additional configuration </td></tr>
</table>
<p>In case something went wrong, here is the response the server send to the client.</p>
<table class="doxtable">
<tr>
<th>Frame </th><th>Content </th><th>Type  </th></tr>
<tr>
<td>1 </td><td>"KO" </td><td><code>string</code> </td></tr>
<tr>
<td>2 </td><td>Reason </td><td><code>string</code> </td></tr>
</table>
<h2><a class="anchor" id="remote_control_cmd_sync_from"></a>
SYNC_FROM </h2>
<p>The <code>SYNC_FROM</code> command allows <a class="el" href="../../d6/d58/namespaceLeosac.html">Leosac</a> to replicate the configuration of an other <a class="el" href="../../d6/d58/namespaceLeosac.html">Leosac</a> unit.</p>
<p><b>SECURITY CONSIDERATION</b>: A module can have additional configuration file. In order to correctly replicate a configuration, we need to copy (and paste) those files too. <a class="el" href="../../d6/d58/namespaceLeosac.html">Leosac</a> will do that. That means that it will <b>blindly write the content of a received file where it is told to</b>. That means that syncing from a malicious unit can cause to overwrite <b>any</b> file in your filesystem (if <a class="el" href="../../d6/d58/namespaceLeosac.html">Leosac</a> runs as root).</p>
<p>From Client to Server:</p>
<table class="doxtable">
<tr>
<th>Frame </th><th>Content </th><th>Type  </th></tr>
<tr>
<td>1 </td><td>"SYNC_FROM" </td><td><code>string</code> </td></tr>
<tr>
<td>2 </td><td>The endpoint to sync from: "tcp://IP:PORT" </td><td><code>string</code> </td></tr>
<tr>
<td>3 </td><td>Autocommit (aka writing conf to disk) <code>1</code> or <code>0</code> </td><td><code>uint8_t</code> </td></tr>
<tr>
<td>4 </td><td>Remote <a class="el" href="../../d6/d58/namespaceLeosac.html">Leosac</a> server key </td><td><code>string</code> </td></tr>
<tr>
<td>5 </td><td>Also sync general config (<code>1</code> or <code>0</code>). </td><td><code>uint8_t</code> </td></tr>
</table>
<p>If the 3rd frame has a value of <code>1</code>, we will write the new configuration to disk as soon as the synchronisation is done.</p>
<p>The 4th frame is the z85 encoded public key of the remote <a class="el" href="../../d6/d58/namespaceLeosac.html">Leosac</a> server. This is an additional security to make sure you are connecting to the server expect to connect to.</p>
<p>The 5th frame is a flag to tell if the general config should also be sync. If not set, only modules list (and their configuration) would be synchronised. If set to <code>1</code>, the general configuration will also be synchronized (honoring <code>sync_from</code> and <code>sync_dest</code>).</p>
<p>Syncing general config has no effect unless autocommit is set to <code>1</code>. The reason is that sync general config will trigger Loesac's restarts. So if the configuration wasn't autocommit'd it will be lost.</p>
<p>Notes: If only the modules (and their config) are synchronised, <a class="el" href="../../d6/d58/namespaceLeosac.html">Leosac</a> will reload them on the fly. However, if the general configuration data (network, logger cfg, remote control configuration) are to be synchronized to, <a class="el" href="../../d6/d58/namespaceLeosac.html">Leosac</a> will restart in order to apply the changes.</p>
<p>From Server to Client (if <b>no error occurred</b>):</p>
<table class="doxtable">
<tr>
<th>Frame </th><th>Content </th><th>Type  </th></tr>
<tr>
<td>1 </td><td>"OK" </td><td><code>string</code> </td></tr>
</table>
<p>From Server to Client (in case <b>something went wrong</b>):</p>
<table class="doxtable">
<tr>
<th>Frame </th><th>Content </th><th>Type  </th></tr>
<tr>
<td>1 </td><td>"KO" </td><td><code>string</code> </td></tr>
<tr>
<td>2 </td><td>Reason </td><td><code>string</code> </td></tr>
</table>
<h2><a class="anchor" id="remote_control_save"></a>
SAVE </h2>
<p>When <code>SYNC_FROM</code> configuration, the new configuration is applied directly but it is not saved to disk, unless the <code>&lt;autosave&gt;BOOLEAN&lt;/autosave&gt;</code> configuration option is set to <code>true</code>.</p>
<p>The <code>SAVE</code> command will make <a class="el" href="../../d6/d58/namespaceLeosac.html">Leosac</a> save its current configuration to disk.</p>
<p>From Client to Server:</p>
<table class="doxtable">
<tr>
<th>Frame </th><th>Content </th><th>Type  </th></tr>
<tr>
<td>1 </td><td>"SAVE" </td><td><code>string</code> </td></tr>
</table>
<p>From Server to Client:</p>
<table class="doxtable">
<tr>
<th>Frame </th><th>Content </th><th>Type  </th></tr>
<tr>
<td>1 </td><td>"OK" </td><td><code>string</code> </td></tr>
</table>
<p>It is possible the <code>SAVE</code> command fails, if that's the case, the response will be 2 frames:</p>
<table class="doxtable">
<tr>
<th>Frame </th><th>Content </th><th>Type  </th></tr>
<tr>
<td>1 </td><td>"KO" </td><td><code>string</code> </td></tr>
<tr>
<td>2 </td><td>"Some reason of why it fails." </td><td><code>string</code> </td></tr>
</table>
<h2><a class="anchor" id="remote_control_config_version"></a>
CONFIG_VERSION </h2>
<p>This returns the current version number of the configuration. This number should ever always increase. It is used in master/slave mode to poll for configuration change.</p>
<p>From Client to Server:</p>
<table class="doxtable">
<tr>
<th>Frame </th><th>Content </th><th>Type  </th></tr>
<tr>
<td>1 </td><td>"CONFIG_VERSION" </td><td><code>string</code> </td></tr>
</table>
<p>From Server to Client:</p>
<table class="doxtable">
<tr>
<th>Frame </th><th>Content </th><th>Type  </th></tr>
<tr>
<td>1 </td><td>42 </td><td><code>uint64_t</code> </td></tr>
</table>
<p>This command cannot fail. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Dec 22 2016 14:36:36 for Leosac by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.12
</small></address>
</body>
</html>
