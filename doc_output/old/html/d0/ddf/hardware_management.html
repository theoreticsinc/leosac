<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.12"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Leosac: Hardware Management</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Leosac
   &#160;<span id="projectnumber">0.6.3</span>
   </div>
   <div id="projectbrief">OpenSourceAccessControl</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.12 -->
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',false,false,'search.php','Search');
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Hardware Management </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#hardware_management_intro">Introduction </a></li>
<li class="level1"><a href="#hardware_management_mba">A Module based architecture </a><ul><li class="level2"><a href="#hardware_management_example">An example of hardware management </a></li>
</ul>
</li>
<li class="level1"><a href="#hardware_mod_spec">Hardware modules specifications </a><ul><li class="level2"><a href="#hardware_spec_gpio">Specification for GPIOs modules </a><ul><li class="level3"><a href="#hardware_spec_gpio_state">STATE</a></li>
<li class="level3"><a href="#hardware_spec_gpio_on">ON</a></li>
<li class="level3"><a href="#hardware_spec_gpio_off">OFF</a></li>
<li class="level3"><a href="#hardware_spec_gpio_toggle">TOGGLE</a></li>
</ul>
</li>
<li class="level2"><a href="#hardware_spec_led">Specification for LEDs modules </a><ul><li class="level3"><a href="#hardware_spec_led_state">STATE</a></li>
<li class="level3"><a href="#hardware_spec_led_blink">BLINK</a></li>
</ul>
</li>
<li class="level2"><a href="#hardware_spec_buzzer">Specification for Buzzer modules </a></li>
<li class="level2"><a href="#hardware_spec_wiegand">Specification for Wiegand module </a><ul><li class="level3"><a href="#hardware_spec_wiegand_beep">BEEP</a></li>
<li class="level3"><a href="#hardware_spec_wiegand_beep_on">BEEP_ON</a></li>
<li class="level3"><a href="#hardware_spec_wiegand_beep_off">BEEP_OFF</a></li>
<li class="level3"><a href="#hardware_spec_wiegand_greenled">GREEN_LED</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><p>An explanation of how hardware modules work together.</p>
<h1><a class="anchor" id="hardware_management_intro"></a>
Introduction </h1>
<p>Since the main goal of <a class="el" href="../../d6/d58/namespaceLeosac.html">Leosac</a> is to handle access control of physical object (mainly doors), and because it reads data from specific hardware (various wiegand reader) we can say that the hardware plays an important role in the project.</p>
<p>We must be able to interface with various devices, in various setup. A strong abstraction of the hardware is in place. This allows easy and flexible configuration for the end-user, and help with maintaining and expanding the code.</p>
<h1><a class="anchor" id="hardware_management_mba"></a>
A Module based architecture </h1>
<p>As you probably already know, <a class="el" href="../../d6/d58/namespaceLeosac.html">Leosac</a> is built around modules (aka shared library). <a class="el" href="../../d6/d58/namespaceLeosac.html">Leosac</a> module are more than just plugins. They do not extend core functionalities, they <b>provide</b> them. If you do not start any module, <a class="el" href="../../d6/d58/namespaceLeosac.html">Leosac</a> will be useless and will literally sleep forever.</p>
<p>The core infrastructure is designed to support modules and provide facilities for them to communicate with each other. Modules communicate using message-passing: <a href="http://zeromq.org">libzmq</a> (and the <a href="https://github.com/zeromq/zmqpp">C++ binding: zmqpp</a>) are used to implement this message passing. Various specifications about how messages are supposed to be formatted and the expected interaction between components are defined through the project.</p>
<p>This is a graphic overview of hardware modules. The GPIO module can be changed without impacting the other modules on top if it, provided that it properly implements the specifications.</p>
<div class="image">
<img src="../../../resources/hardware.png" alt="Modules Images"/>
</div>
 <h2><a class="anchor" id="hardware_management_example"></a>
An example of hardware management </h2>
<p>So, let's see how this module based architecture impact hardware management. Let's suppose we want to control a Wiegand card reader: This means that we must be able to read a card number from it, and that must be able to control the device's led and buzzer.</p>
<p>We can see our wiegand reader as multiple sub-components:</p><ul>
<li>A LED.</li>
<li>A buzzer.</li>
<li>A <code>data0</code> input PIN.</li>
<li>A <code>data1</code> input PIN.</li>
</ul>
<p>We can go a bit lower and identify other sub-components:</p><ul>
<li>A LED...<ol type="1">
<li>... that relies on a GPIO output PIN.</li>
</ol>
</li>
<li>A buzzer...<ol type="1">
<li>... that relies on a GPIO output PIN too.</li>
</ol>
</li>
<li>A <code>data0</code> input PIN.</li>
<li>A <code>data1</code> input PIN.</li>
</ul>
<p><code>data0</code> and <code>data1</code> are GPIO input PIN already.</p>
<p>There are 4 kind of hardware here: GPIO, Led, Buzzer and Wiegand Reader. Led and Buzzer are implemented as one. We have (at least) one module per device type. A module for a specific hardware provide support for it.</p>
<p>The LED module requires that a GPIO module exposes the GPIO to the application in order to work. Same goes for the Wiegand module. GPIO can be provided by 2 modules: Through the PifaceDigital card, or through sysfs. The other do not care what module handle the GPIO. As long as one of them do, and respects the specifications.</p>
<p>So, in our example, here is what happens when a card is presented to the reader:</p><ol type="1">
<li>The hardware GPIO will emit some GPIO interrupt.</li>
<li>The GPIO module (doesn't matter which one) will read those interrupt and present them to the application as messages. (remember, we heavily use message passing)</li>
<li>The Wiegand Module will read the GPIO interrupt from the GPIO module (in the same way, independently of the underlying GPIO module) and will build a card number from those. This information is then sent to the authentication module.</li>
<li>The authentication module chose whether the access shall be granted or not, and publish this information.</li>
<li>The <code>doorman</code> module picks this up, and eventually open a door.</li>
</ol>
<hr/>
<h1><a class="anchor" id="hardware_mod_spec"></a>
Hardware modules specifications </h1>
<p>You can find below the specifications that must be implemented when writing a module that provide support for some kind of hardware.</p>
<h2><a class="anchor" id="hardware_spec_gpio"></a>
Specification for GPIOs modules </h2>
<p>A module that implements GPIOs support must:</p><ol type="1">
<li>Allow user to configure <code>input</code> / <code>output</code> pin and let them associate a name per GPIO.</li>
<li>Allow other modules to talk to each GPIO individually, by name.</li>
</ol>
<p>A facade object, <a class="el" href="../../d0/dea/classLeosac_1_1Hardware_1_1FGPIO.html">FGPIO</a> implements client-code (requests) of those specs, and the module must implement the server-code (responses).</p>
<p>We define 4 commands that can be send to a GPIO device:</p><ul>
<li><a class="el" href="../../d0/ddf/hardware_management.html#hardware_spec_gpio_state">STATE</a>.</li>
<li><a class="el" href="../../d0/ddf/hardware_management.html#hardware_spec_gpio_on">ON</a>.</li>
<li><a class="el" href="../../d0/ddf/hardware_management.html#hardware_spec_gpio_off">OFF</a>.</li>
<li><a class="el" href="../../d0/ddf/hardware_management.html#hardware_spec_gpio_toggle">TOGGLE</a>.</li>
</ul>
<h3><a class="anchor" id="hardware_spec_gpio_state"></a>
STATE</h3>
<p>This is used to query the state of the GPIO pin.</p>
<p><em>Request</em>:</p>
<table class="doxtable">
<tr>
<th>Frame </th><th>Content </th><th>Type  </th></tr>
<tr>
<td>1 </td><td>"STATE" </td><td><code>string</code> </td></tr>
</table>
<p><em>Response</em>:</p>
<table class="doxtable">
<tr>
<th>Frame </th><th>Content </th><th>Type  </th></tr>
<tr>
<td>1 </td><td>"ON" or "OFF" </td><td><code>string</code> </td></tr>
</table>
<h3><a class="anchor" id="hardware_spec_gpio_on"></a>
ON</h3>
<p>This turns the pin high. It accepts an optional <code>duration</code> parameter. If set, this parameter express the <code>duration</code> for which the GPIO shall stay high. This <code>duration</code> is expressed in milliseconds. The module shall turn the GPIO off after this <code>duration</code> has expired.</p>
<p><em>Request</em>:</p>
<table class="doxtable">
<tr>
<th>Frame </th><th>Content </th><th>Type  </th></tr>
<tr>
<td>1 </td><td>"ON" </td><td><code>string</code> </td></tr>
<tr>
<td>2 </td><td>3500 </td><td><code>int64_t</code> </td></tr>
</table>
<p><em>Response</em>:</p>
<table class="doxtable">
<tr>
<th>Frame </th><th>Content </th><th>Type  </th></tr>
<tr>
<td>1 </td><td>"OK" or "KO" </td><td><code>string</code> </td></tr>
</table>
<dl class="section note"><dt>Note</dt><dd>While it would return "KO" on error, it shouldn't fail, ever.</dd></dl>
<h3><a class="anchor" id="hardware_spec_gpio_off"></a>
OFF</h3>
<p>This turns the GPIO low. There is no parameter.</p>
<p><em>Request</em>:</p>
<table class="doxtable">
<tr>
<th>Frame </th><th>Content </th><th>Type  </th></tr>
<tr>
<td>1 </td><td>"OFF" </td><td><code>string</code> </td></tr>
</table>
<p><em>Response</em>:</p>
<table class="doxtable">
<tr>
<th>Frame </th><th>Content </th><th>Type  </th></tr>
<tr>
<td>1 </td><td>"OK" or "KO" </td><td><code>string</code> </td></tr>
</table>
<dl class="section note"><dt>Note</dt><dd>While it would return "KO" on error, it shouldn't fail, ever.</dd></dl>
<h3><a class="anchor" id="hardware_spec_gpio_toggle"></a>
TOGGLE</h3>
<p>Toggle the GPIO, setting it to low it was set to high, and vice versa. This command takes no parameter.</p>
<p><em>Request</em>:</p>
<table class="doxtable">
<tr>
<th>Frame </th><th>Content </th><th>Type  </th></tr>
<tr>
<td>1 </td><td>"TOGGLE" </td><td><code>string</code> </td></tr>
</table>
<p><em>Response</em>:</p>
<table class="doxtable">
<tr>
<th>Frame </th><th>Content </th><th>Type  </th></tr>
<tr>
<td>1 </td><td>"OK" or "KO" </td><td><code>string</code> </td></tr>
</table>
<dl class="section note"><dt>Note</dt><dd>While it would return "KO" on error, it shouldn't fail, ever.</dd></dl>
<hr/>
<h2><a class="anchor" id="hardware_spec_led"></a>
Specification for LEDs modules </h2>
<p>A module that implements LED devices support must:</p><ol type="1">
<li>Allow user to identified LED by name.</li>
<li>Allows module to communicate with configured LED device, by name.</li>
<li>Let the user chose a default</li>
</ol>
<p>Note that some GPIO commands are also valid LED command.</p>
<p>We define 5 commands that can be send to a LED device:</p><ul>
<li><a class="el" href="../../d0/ddf/hardware_management.html#hardware_spec_led_state">STATE</a>.</li>
<li><a class="el" href="../../d0/ddf/hardware_management.html#hardware_spec_gpio_on">ON</a>. This works exactly like the <code>ON</code> command for GPIO.</li>
<li><a class="el" href="../../d0/ddf/hardware_management.html#hardware_spec_gpio_off">OFF</a>. This works exactly like the <code>ON</code> command for GPIO.</li>
<li><a class="el" href="../../d0/ddf/hardware_management.html#hardware_spec_gpio_toggle">TOGGLE</a>. This works exactly like the <code>TOGGLE</code> command for GPIO.</li>
<li><a class="el" href="../../d0/ddf/hardware_management.html#hardware_spec_led_blink">BLINK</a>.</li>
</ul>
<h3><a class="anchor" id="hardware_spec_led_state"></a>
STATE</h3>
<p>Shall return the state of the LED device.</p>
<p><em>Request</em>:</p>
<table class="doxtable">
<tr>
<th>Frame </th><th>Content </th><th>Type  </th></tr>
<tr>
<td>1 </td><td>"STATE" </td><td><code>string</code> </td></tr>
</table>
<p><em>Response</em>:</p>
<table class="doxtable">
<tr>
<th>Frame </th><th>Content </th><th>Type </th><th>Comment  </th></tr>
<tr>
<td>1 </td><td>"ON" or "OFF" or "BLINKING" </td><td><code>string</code> </td><td>- </td></tr>
<tr>
<td>2 </td><td>BLINK_DURATION </td><td><code>int64_t</code> </td><td>Only if frame 1 is "BLINKING" </td></tr>
<tr>
<td>3 </td><td>BLINK_SPEED </td><td><code>int64_t</code> </td><td>Only if frame 1 is "BLINKING" </td></tr>
<tr>
<td>4 </td><td>"ON" or "OFF" </td><td><code>string</code> </td><td>Only if frame 1 is "BLINKING" - indicate the current value when the command was received. </td></tr>
</table>
<h3><a class="anchor" id="hardware_spec_led_blink"></a>
BLINK</h3>
<p>This makes the LED blink, useful for controlling your christmas tree. The <code>BLINK</code> command accepts 2 optionals parameter: a <code>duration</code> and a <code>speed</code>. Both are expressed in milliseconds.</p>
<p>The second frame shall contain the duration (use -1 for infinite blink) and the third frame the speed.</p>
<p><em>Request</em>:</p>
<table class="doxtable">
<tr>
<th>Frame </th><th>Content </th><th>Type </th><th>Comment  </th></tr>
<tr>
<td>1 </td><td>"BLINK" </td><td><code>string</code> </td><td>- </td></tr>
<tr>
<td>2 </td><td>BLINK_DURATION </td><td><code>int64_t</code> </td><td>Optional. In milliseconds. </td></tr>
<tr>
<td>3 </td><td>BLINK_SPEED </td><td><code>int64_t</code> </td><td>Optional. In milliseconds. </td></tr>
</table>
<p><em>Response</em>:</p>
<table class="doxtable">
<tr>
<th>Frame </th><th>Content </th><th>Type  </th></tr>
<tr>
<td>1 </td><td>"OK" or "KO" </td><td><code>string</code> </td></tr>
</table>
<dl class="section note"><dt>Note</dt><dd>While it would return "KO" on error, it shouldn't fail, ever.</dd></dl>
<hr/>
<h2><a class="anchor" id="hardware_spec_buzzer"></a>
Specification for Buzzer modules </h2>
<p>Buzzer and LED share the same code. See the <a class="el" href="../../d0/ddf/hardware_management.html#hardware_spec_led">led module specifications</a>.</p>
<hr/>
<h2><a class="anchor" id="hardware_spec_wiegand"></a>
Specification for Wiegand module </h2>
<p>A wiegand reader device shall have 2 inputs GPIO configured and optional greenled and buzzer devices.</p>
<h3>Command specifications:</h3>
<p>A wiegand device shall accept 4 commands:</p><ul>
<li><a class="el" href="../../d0/ddf/hardware_management.html#hardware_spec_wiegand_beep">BEEP</a>.</li>
<li><a class="el" href="../../d0/ddf/hardware_management.html#hardware_spec_wiegand_beep_on">BEEP_ON</a>.</li>
<li><a class="el" href="../../d0/ddf/hardware_management.html#hardware_spec_wiegand_beep_off">BEEP_OFF</a>.</li>
<li><a class="el" href="../../d0/ddf/hardware_management.html#hardware_spec_wiegand_greenled">GREEN_LED</a>.</li>
</ul>
<h3><a class="anchor" id="hardware_spec_wiegand_beep"></a>
BEEP</h3>
<p>Make the reader beep for a given duration. The duration is expressed in milliseconds.</p>
<p><em>Request</em>:</p>
<table class="doxtable">
<tr>
<th>Frame </th><th>Content </th><th>Type </th><th>Comment  </th></tr>
<tr>
<td>1 </td><td>"BEEP" </td><td><code>string</code> </td><td>- </td></tr>
<tr>
<td>2 </td><td>BEEP_DURATION </td><td><code>int64_t</code> </td><td>In milliseconds. </td></tr>
</table>
<p><em>Response</em>:</p>
<table class="doxtable">
<tr>
<th>Frame </th><th>Content </th><th>Type  </th></tr>
<tr>
<td>1 </td><td>"OK" or "KO" </td><td><code>string</code> </td></tr>
</table>
<dl class="section note"><dt>Note</dt><dd>Would return "KO" if the reader had no associated buzzer (or if the underlying GPIO returned KO &ndash; unlikely).</dd></dl>
<h3><a class="anchor" id="hardware_spec_wiegand_beep_on"></a>
BEEP_ON</h3>
<p>Turn the buzzer of the reader on. No duration.</p>
<p><em>Request</em>:</p>
<table class="doxtable">
<tr>
<th>Frame </th><th>Content </th><th>Type </th><th>Comment  </th></tr>
<tr>
<td>1 </td><td>"BEEP_ON" </td><td><code>string</code> </td><td>- </td></tr>
</table>
<p><em>Response</em>:</p>
<table class="doxtable">
<tr>
<th>Frame </th><th>Content </th><th>Type  </th></tr>
<tr>
<td>1 </td><td>"OK" or "KO" </td><td><code>string</code> </td></tr>
</table>
<dl class="section note"><dt>Note</dt><dd>Would return "KO" if the reader had no associated buzzer (or if the underlying GPIO returned KO &ndash; unlikely).</dd></dl>
<h3><a class="anchor" id="hardware_spec_wiegand_beep_off"></a>
BEEP_OFF</h3>
<p>Turn the buzzer of the reader off.</p>
<p><em>Request</em>:</p>
<table class="doxtable">
<tr>
<th>Frame </th><th>Content </th><th>Type </th><th>Comment  </th></tr>
<tr>
<td>1 </td><td>"BEEP_OFF" </td><td><code>string</code> </td><td>- </td></tr>
</table>
<p><em>Response</em>:</p>
<table class="doxtable">
<tr>
<th>Frame </th><th>Content </th><th>Type  </th></tr>
<tr>
<td>1 </td><td>"OK" or "KO" </td><td><code>string</code> </td></tr>
</table>
<dl class="section note"><dt>Note</dt><dd>Would return "KO" if the reader had no associated buzzer (or if the underlying GPIO returned KO &ndash; unlikely).</dd></dl>
<h3><a class="anchor" id="hardware_spec_wiegand_greenled"></a>
GREEN_LED</h3>
<p>Forward a command to the greenled device of the reader.</p>
<p><em>Request</em>:</p>
<table class="doxtable">
<tr>
<th>Frame </th><th>Content </th><th>Type </th><th>Comment  </th></tr>
<tr>
<td>1 </td><td>"GREEN_LED" </td><td><code>string</code> </td><td>- </td></tr>
<tr>
<td>2 </td><td>xxx </td><td><code>xxx</code> </td><td>Command for the LED device. </td></tr>
<tr>
<td>3 </td><td>yyy </td><td><code>yyy</code> </td><td>Parameter 1 for the command. Can have more, or none. </td></tr>
</table>
<p><em>Response</em>:</p>
<table class="doxtable">
<tr>
<th>Frame </th><th>Content </th><th>Type  </th></tr>
<tr>
<td>1 </td><td>"OK" or "KO" </td><td><code>string</code> </td></tr>
</table>
<dl class="section note"><dt>Note</dt><dd>Would return "KO" if the reader had no associated green led.</dd></dl>
<hr/>
 </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Dec 22 2016 14:36:36 for Leosac by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.12
</small></address>
</body>
</html>
