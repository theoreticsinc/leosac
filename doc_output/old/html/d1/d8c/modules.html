<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.12"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Leosac: Leosac&#39;s Modules</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Leosac
   &#160;<span id="projectnumber">0.6.3</span>
   </div>
   <div id="projectbrief">OpenSourceAccessControl</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.12 -->
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',false,false,'search.php','Search');
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title"><a class="el" href="../../d6/d58/namespaceLeosac.html">Leosac</a>'s Modules </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#modules_brief_intro">A brief introduction </a></li>
<li class="level1"><a href="#modules_enduser">As an end-user, what should I know? </a><ul><li class="level2"><a href="#modules_enduser_use">Using and configuring modules </a></li>
<li class="level2"><a href="#modules_enduser_what">What modules do I need? </a></li>
<li class="level2"><a href="#module_enduser_overview">Overview of existing modules </a></li>
</ul>
</li>
<li class="level1"><a href="#modules_dev">Developers Informations </a><ul><li class="level2"><a href="#modules_communication">How modules communicate ? </a></li>
<li class="level2"><a href="#modules_write">Writing a new module </a></li>
<li class="level2"><a href="#modules_write_tips">Tips </a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><p>An introduction to modules.</p>
<p>This pages aims to be an introduction to modules in <a class="el" href="../../d6/d58/namespaceLeosac.html">Leosac</a>, both for the non-technical end-user and for developers. The developers part assumes the end-user was read and understood.</p>
<h1><a class="anchor" id="modules_brief_intro"></a>
A brief introduction </h1>
<p>Modules are what provides features to <a class="el" href="../../d6/d58/namespaceLeosac.html">Leosac</a>: devices supports, authentication backend, monitoring, all are implemented through modules. Modules are cool because they allows to build the configuration you want by enabling only the feature you will use. It also makes it easy to expand (or reimplement) the existing functionally.</p>
<hr/>
<h1><a class="anchor" id="modules_enduser"></a>
As an end-user, what should I know? </h1>
<p>You should know (or be able to find out) what modules you need for your use case. You then need to be able to properly configure them.</p>
<h2><a class="anchor" id="modules_enduser_use"></a>
Using and configuring modules </h2>
<p>Where to find modules, which modules to load, and their basic configuration take place in the the <code>core configuration file</code>. You can read-up a per-module documentation that will detail and explain how to configure the module.</p>
<p>Some module may have additional configuration files in order to not bloat the main config file.</p>
<h2><a class="anchor" id="modules_enduser_what"></a>
What modules do I need? </h2>
<p>It's not really possible to answer this, because it depends heavily and how you plan to use <a class="el" href="../../d6/d58/namespaceLeosac.html">Leosac</a>. However, if you're doing access-control you will generally need:</p><ol type="1">
<li>A module to provide support for GPIO pins.</li>
<li>The module that implements support for Wiegand device.</li>
<li>An authentication backend module that will determine whether an user shall be granted access or not.</li>
<li>A module to take action when an authentication attempt happen. This is the <a class="el" href="../../d6/d2b/mod_doorman_main.html">doorman</a> module.</li>
</ol>
<h2><a class="anchor" id="module_enduser_overview"></a>
Overview of existing modules </h2>
<table class="doxtable">
<tr>
<th>Name </th><th>Description </th><th>More info  </th></tr>
<tr>
<td>SysFS GPIO </td><td>Provide support for GPIO through SysFS </td><td>Hardware module </td></tr>
<tr>
<td>PifaceDigital </td><td>Provide support for GPIO through the Piface digital device </td><td>Hardware module </td></tr>
<tr>
<td>Led-Buzzer </td><td>Support Led and buzzer devices. </td><td>Hardware module, requires a GPIO module </td></tr>
<tr>
<td>Wiegand </td><td>Support wiegand device. </td><td>Hardware module, Authentication Source module. Requires GPIO module. </td></tr>
<tr>
<td>Auth-File </td><td>Implementation permissions checking / auth validation </td><td>Authentication backend module. </td></tr>
<tr>
<td>Doorman </td><td>Take actions when an authentication attempt succeed or fails </td><td>Policy implementation module (takes actions on event) </td></tr>
<tr>
<td>Replication </td><td>Allows <a class="el" href="../../d6/d58/namespaceLeosac.html">Leosac</a> to run in a master/slave configuration </td><td>- </td></tr>
<tr>
<td>Monitor </td><td>Additional logs. Provide activity feedback (is network down?) </td><td>- </td></tr>
</table>
<hr/>
<h1><a class="anchor" id="modules_dev"></a>
Developers Informations </h1>
<p>The following section is aimed toward developers.</p>
<p><a class="el" href="../../d6/d58/namespaceLeosac.html">Leosac</a>'s core loads a bunch of modules (as defined in the configuration file) and everything talks to each other.</p>
<p>See the <a class="el" href="../../df/dc3/namespaceLeosac_1_1Module.html">Leosac::Module</a> namespace for a reference of all modules.</p>
<p>When configuring a module, the name specified in the configuration file must match the name provided by the module through its <code><a class="el" href="../../d8/dbb/leosac-evoxs_2init_8cpp.html#a0c07748a38a5c9b9cd82c9de2053cf14">get_module_name()</a></code> function.</p>
<h2><a class="anchor" id="modules_communication"></a>
How modules communicate ? </h2>
<p>Modules to modules communication and core to modules communication does <b>NOT</b> happen by invoking methods on each other. Instead, we have a higher level of abstraction in place: we use message passing. Each module has a mailbox and can receive (and send) messages to anyone.</p>
<p>For this to work, proper specifications must be in place, so that we can swap an implementation with an other without changing anything else in dependants modules. For example, we can use either the Piface device (and the Piface module) to implements GPIO, but we could also use the SysfsGPIO module. Other modules that needs to use GPIO do not care which GPIO module is loaded and provide the support for the GPIOs.</p>
<p><a class="el" href="../../d6/d58/namespaceLeosac.html">Leosac</a>'s core also set up a message-bus where everyone can write and read from everyone else. This is useful to broadcast information and is used a lot.</p>
<div class="image">
<img src="../../../resources/modules_communication.png" alt="Modules communications"/>
</div>
<h2><a class="anchor" id="modules_write"></a>
Writing a new module </h2>
<p>To write a new module you need to code either in C++ or eventually in C. There are a few guidelines (some are even requirements) that you have to follow in order to write a module compliant with the <a class="el" href="../../d6/d58/namespaceLeosac.html">Leosac</a> system.</p>
<p>If you're going to write a module to handle hardware devices (leds, gpios, etc) take a look at the current implementation and to the specifications of said device:</p><ul>
<li><a class="el" href="../../d0/dea/classLeosac_1_1Hardware_1_1FGPIO.html">GPIO</a></li>
<li><a class="el" href="../../db/df5/classLeosac_1_1Hardware_1_1FLED.html">LED</a></li>
<li><a class="el" href="../../d7/dc6/classLeosac_1_1Hardware_1_1FWiegandReader.html">Wiegand Reader</a></li>
</ul>
<h2><a class="anchor" id="modules_write_tips"></a>
Tips </h2>
<p>It is recommended to derive from <a class="el" href="../../df/d9f/classLeosac_1_1Module_1_1BaseModule.html">BaseModule</a> to implement your own module. This base class make things easier. However, it doesn't take care of everything.</p>
<p>There are hard requirements regarding which symbols your shared library (aka modules) must export:</p><ol type="1">
<li>A function named <code>start_module()</code> with the following prototype: <code>bool start_module(zmqpp::socket *pipe, boost::property_tree::ptree cfg, zmqpp::context &amp;zmq_ctx, CoreUtilsPtr utils)</code></li>
<li>A function named <code><a class="el" href="../../d8/dbb/leosac-evoxs_2init_8cpp.html#a0c07748a38a5c9b9cd82c9de2053cf14">get_module_name()</a></code> that takes no parameters and return a <code>const char *</code> that points to the name of the module. This string must be <code>NULL</code> terminated. Note that the returned module name shall be composed of capital letter, number and underscore only.</li>
</ol>
<p>The <code>start_module()</code> function can be a one liner if you use the the <code>BaseModule</code> class and the helper <a class="el" href="../../df/dc3/namespaceLeosac_1_1Module.html#acf0a9339e2feffbdfa5fba060756d109">start_module_helper</a>. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Dec 22 2016 14:36:36 for Leosac by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.12
</small></address>
</body>
</html>
